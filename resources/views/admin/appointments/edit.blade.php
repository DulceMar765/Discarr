{{-- resources/views/admin/appointments/edit.blade.php --}}\n\n<div class=\"admin-section\">\n    <h2 class=\"mb-4\"><i class=\"bi bi-calendar-check me-2\"></i> Editar Reservación</h2>\n\n    <form id="editAppointmentForm" action="/admin/appointments/{{ $appointment->id }}" method="POST">\n        @csrf\n        @method('PUT')\n\n        <div class=\"card shadow-sm mb-4\">\n            <div class=\"card-body\">\n                <div class=\"row\">\n                    <div class=\"col-md-6\">\n                        <h5 class=\"mb-3\">Información de la Reservación</h5>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"calendar_day\" class=\"form-label\">Fecha</label>\n                            <input type=\"date\" id=\"calendar_day\" name=\"calendar_day\" class=\"form-control\" value=\"{{ $appointment->calendarDay->date }}\" required>\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"time_slot\" class=\"form-label\">Hora</label>\n                            <select id=\"time_slot\" name=\"time_slot\" class=\"form-select\" required>\n                                <option value=\"\">Selecciona un horario</option>\n                                @foreach ($availableSlots as $slot)\n                                    <option value=\"{{ $slot }}\" {{ $slot == $appointment->time_slot ? 'selected' : '' }}>{{ $slot }}</option>\n                                @endforeach\n                            </select>\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"status\" class=\"form-label\">Estado</label>\n                            <select id=\"status\" name=\"status\" class=\"form-select\" required>\n                                <option value=\"pending\" {{ $appointment->status == 'pending' ? 'selected' : '' }}>Pendiente</option>\n                                <option value=\"confirmed\" {{ $appointment->status == 'confirmed' ? 'selected' : '' }}>Confirmada</option>\n                                <option value=\"cancelled\" {{ $appointment->status == 'cancelled' ? 'selected' : '' }}>Cancelada</option>\n                            </select>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-md-6\">\n                        <h5 class=\"mb-3\">Datos del Solicitante</h5>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"requester_name\" class=\"form-label\">Nombre completo</label>\n                            <input type=\"text\" id=\"requester_name\" name=\"requester_name\" class=\"form-control\" value=\"{{ $appointment->requester_name }}\" required>\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"requester_email\" class=\"form-label\">Correo electrónico</label>\n                            <input type=\"email\" id=\"requester_email\" name=\"requester_email\" class=\"form-control\" value=\"{{ $appointment->requester_email }}\" required>\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label for=\"requester_phone\" class=\"form-label\">Teléfono</label>\n                            <input type=\"tel\" id=\"requester_phone\" name=\"requester_phone\" class=\"form-control\" value=\"{{ $appointment->requester_phone }}\" required>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"mb-3\">\n                    <label for=\"description\" class=\"form-label\">Descripción / Motivo de la cita</label>\n                    <textarea id=\"description\" name=\"description\" class=\"form-control\" rows=\"3\" required>{{ $appointment->description }}</textarea>\n                </div>\n                \n                <div class=\"mb-3\">\n                    <label for=\"admin_notes\" class=\"form-label\">Notas administrativas (solo visibles para administradores)</label>\n                    <textarea id=\"admin_notes\" name=\"admin_notes\" class=\"form-control\" rows=\"2\">{{ $appointment->admin_notes }}</textarea>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"text-end\">\n            <a href=\"#\" onclick=\"loadAdminSection('/admin/appointments'); return false;\" class=\"btn btn-secondary me-2\">Cancelar</a>\n            <button type=\"submit\" class=\"btn btn-primary\">Actualizar Reservación</button>\n        </div>\n    </form>\n</div>\n\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        const form = document.getElementById('editAppointmentForm');\n        const dateInput = document.getElementById('calendar_day');\n        const timeSlotSelect = document.getElementById('time_slot');\n        \n        // Actualizar horarios disponibles cuando cambia la fecha\n        dateInput.addEventListener('change', function() {\n            const selectedDate = this.value;\n            \n            fetch(`/admin/appointments/available-slots?date=${selectedDate}`)\n                .then(response => response.json())\n                .then(data => {\n                    // Limpiar opciones actuales\n                    timeSlotSelect.innerHTML = '<option value=\"\">Selecciona un horario</option>';\n                    \n                    // Agregar nuevas opciones\n                    data.slots.forEach(slot => {\n                        const option = document.createElement('option');\n                        option.value = slot;\n                        option.textContent = slot;\n                        timeSlotSelect.appendChild(option);\n                    });\n                })\n                .catch(error => console.error('Error:', error));\n        });\n        \n        // Manejar envío del formulario\n        form.addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const formData = new FormData(form);\n            \n            fetch(form.action, {\n                method: 'POST',\n                body: formData,\n                headers: {\n                    'X-Requested-With': 'XMLHttpRequest',\n                    'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content')\n                }\n            })\n            .then(response => {\n                if (response.redirected) {\n                    loadAdminSection('/admin/appointments');\n                } else {\n                    return response.json();\n                }\n            })\n            .then(data => {\n                if (data && data.errors) {\n                    // Mostrar errores\n                    alert('Error: ' + Object.values(data.errors).join('\\n'));\n                }\n            })\n            .catch(error => {\n                console.error('Error:', error);\n                loadAdminSection('/admin/appointments');\n            });\n        });\n    });\n</script>
